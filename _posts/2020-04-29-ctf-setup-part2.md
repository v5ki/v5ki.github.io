---
layout: post
title:  "–ß—Ç–æ –Ω–∞–º —Å—Ç–æ–∏—Ç CTF —É—Å—Ç—Ä–æ–∏—Ç—å? –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤"
date:   2020-04-29 10:00:00 +0300
categories: smartrhino backstage
---

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/main.png" width="500">
    <br/>
    <i>–ò–º–µ–Ω–Ω–æ —Ç–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ CTFd –≤ –º–æ–∏—Ö –≥–ª–∞–∑–∞—Ö</i>
</p>

–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø–∞–±–ª–∏–∫–∞ [SMARTRHINO](https://vk.com/smartrhino).

–ü—Ä–æ–¥–æ–ª–∂–∏–º –Ω–∞—à–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –∑–∞–∫—É–ª–∏—Å—å—é SMARTRHINO.  
–°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤, –≤–æ–∑–Ω–∏–∫—à–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏ –ø—É—Ç—è—Ö –∏—Ö —Ä–µ—à–µ–Ω–∏–π.

## 0004. Docker, –ø—Ä–∏–≤–µ—Ç!
–ù–∞–ø–æ–º–Ω—é, —Ä–∞–∑—Ä–∞–±–æ—á—Ç–∏–∫–∏ CTFd –∑–∞–≤–µ—Ä—è—é—Ç –Ω–∞—Å, —á—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å CTFd - –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Docker.  
–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∏ –µ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–≥–æ Basic Deployment.  
–ù—É —á—Ç–æ –∂–µ, –Ω–∞—á–Ω—ë–º!

–û—Ç –Ω–∞—Å —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–≤–µ –≤–µ—â–∏: Docker –∏ Docker Compose, —Ä–µ–∞–ª—å–Ω–æ —Ç–µ–ª–æ–¥–≤–∏–∂–µ–Ω–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–µ.
–î–ª—è –Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ Docker, –µ—Å–ª–∏ —Ç–∞–∫–∏–µ –∏–º–µ—é—Ç—Å—è. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ VPS —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π Ubuntu Server 18.04 —É–∂–µ –≤–∫–ª—é—á–∞—é—Ç –≤ —Å–µ–±—è –ø–∞–∫–µ—Ç—ã Docker'–∞, —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–∏ —É –Ω–∏—Ö —Å—Ç–∞—Ä—ã–µ –∏ –Ω–∞–º –Ω–µ –ø–æ–¥–æ–π–¥—É—Ç :(
```bash
sudo apt remove docker docker-engine docker.io containerd runc
```

–û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏ —Å—Ç–∞–≤–∏–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker.
```bash
sudo apt update
sudo apt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
```

–î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π docker –≤ —Å–∏—Å—Ç–µ–º—É, –∞ —Ç–∞–∫–∂–µ –∫–ª—é—á–∏ –¥–ª—è –Ω–µ–≥–æ.
```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
sudo apt-key fingerprint 0EBFCD88
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
```

–°–Ω–æ–≤–∞ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏ —Å—Ç–∞–≤–∏–º Docker CE.
```bash
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
```

–¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å docker-compose, –∏–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –±—É–¥–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º CTFd.  
_P.S. –ù–∞ –º–æ–º–µ–Ω—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –±—ã–ª–∞ –≤–µ—Ä—Å–∏—è 1.25.4, —Å–µ–π—á–∞—Å - 1.25.5._
```bash
sudo curl -L "https://github.com/docker/compose/releases/download/1.25.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
```

–°–æ–∑–¥–∞–¥–∏–º –≥—Ä—É–ø–ø—É `docker` –∏ –¥–æ–±–∞–≤–∏–º –Ω–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω–µ—ë. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å Docker –±–µ–∑ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ—Ä–≤–æ–≤.
```bash
sudo groupadd docker
sudo usermod -aG docker $USER
```

–î–∞—ë–º –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å—ë –≤—Å—Ç–∞–ª–æ –∫–∞–∫ –Ω–∞–¥–æ.
```bash
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
docker run hello-world
```

–ü–æ–ª—É—á–∏–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–≤–æ–¥:
```
docker-compose version 1.25.4, build 8d51620a

Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
ca4f61b1923c: Pull complete
Digest: sha256:ca0eeb6fb05351dfc8759c20733c91def84cb8007aa89a5bf606bc8b315b9fc7
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.
...
```

–ù–∞ —ç—Ç–æ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é CTFd, –Ω–æ –ø—Ä–µ–∂–¥–µ –Ω–∞–¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è.

```bash
sudo reboot now
```

## 0005. CTFd Basic Deployment
–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è, –¥–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–≤–µ—Ä—Ö—ä–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏ –∫–∞–ø–ª–∏ –±–æ–ª–∏.

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Å–µ–≥–æ —Ç—Ä–∏ —Å—Ç—Ä–æ—á–∫–∏ –Ω–∞ Bash:
```bash
git clone https://github.com/CTFd/CTFd.git
cd CTFd/
./prepare.sh
```

`prepare.sh` –¥–µ–ª–∞–µ—Ç –∑–∞ –Ω–∞—Å –≤—Å—é –≥—Ä—è–∑–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω—É —Ö–æ—Ç—å –≥–¥–µ-—Ç–æ :)

–ò—Ç–∞–∫, —É –Ω–∞—Å –≤—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ä–¥—ã, —á—Ç–æ –º—ã –∏ —Å–¥–µ–ª–∞–µ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.
```
docker-compose up --detach
```
–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å, –ø–æ–∫–∞ docker —Å–∫–∞—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±—Ä–∞–∑—ã –∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å `docker-compose.yml`. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –∑–∞–π–º—ë—Ç –ø–æ—Ä—è–¥–∫–∞ 10 –º–∏–Ω—É—Ç, –∏ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è –≤–ø–æ–ª–Ω–µ –º–æ–∂–Ω–æ —É—Å–ø–µ—Ç—å –ø–µ—Ä–µ–∫—É—Å–∏—Ç—å!  
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±–æ—Ä–¥–∞ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ http://localhost:8000  
–ü–µ—Ä–µ–π–¥—è –ø–æ —Å—Å—ã–ª–∫–µ, –º—ã –ø–æ–ø–∞–¥—ë–º –≤ –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/setup-panel.png" width="500">
</p>

–ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è, –∂–º—ë–º _Next_, —Å–Ω–æ–≤–∞ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ, –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ.  
–ù–∞–∂–∏–º–∞–µ–º –∫–Ω–æ–ø–∫—É _Finish_ –∏ –ø–æ–ø–∞–¥–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–æ—Ä–¥—ã. –£—Ä–∞, –ø–µ—Ä–≤—ã–π —à–∞–≥ —Å–¥–µ–ª–∞–Ω.

## 0006. –î–æ–≤–æ–¥–∏–º –¥–æ –∫–æ–Ω–¥–∏—Ü–∏–∏

–ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –º–æ–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏, –∑–∞–π–¥—è –≤ —Ä–∞–∑–¥–µ–ª __Config__, —á—Ç–æ –º—ã –∏ —Å–¥–µ–ª–∞–µ–º.  
–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞: http://localhost:8000/admin/config

–ù–∞—Å –±—É–¥—É—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª—ã __Accounts__, __Settings__, __Email__.  

–í —Ä–∞–∑–¥–µ–ª–µ __Accounts__ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ—á—Ç–æ–≤—ã—Ö —è—â–∏–∫–æ–≤, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ, –∞ —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º—ë–Ω. –ü—Ä–∏ —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –∏—Å–∫–∞—Ç—å.

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/accounts.png" width="500">
</p>

–í —Ä–∞–∑–¥–µ–ª–µ __Settings__ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Ç–µ—Ö –∏–ª–∏ –∏–Ω—ã—Ö —Å–≤–µ–¥–µ–Ω–∏–π –æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏: —Ç–∞—Å–∫–∏, –æ—á–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è.  
–≠—Ç–æ —É–∂ –Ω–∞ —Å–≤–æ–π –≤–∫—É—Å –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ, —á—Ç–æ –∏ –∫–∞–∫ –í–∞–º –Ω–∞–¥–æ)

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/settings.png" width="500">
</p>
–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–µ–Ω –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏ - 2.3.3, –∑–∞–ø–æ–º–Ω–∏—Ç–µ –µ–≥–æ, —á—É—Ç—å –ø–æ–∑–∂–µ –º—ã –∫ –Ω–µ–º—É –≤–µ—Ä–Ω—ë–º—Å—è.  


–ù—É –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–¥–µ–ª, –≤ –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥–ª—è–Ω–µ–º - __Email__, —ç—Ç–æ—Ç –ø–∞—Ä–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∏–ª –º–∞—Å—Å—É —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π, —ç–º–æ—Ü–∏–∏ –±–∏–ª–∏ —á–µ—Ä–µ–∑ –∫—Ä–∞–π ü§¨.
–ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è, –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ –≤ –ø—Ä–æ—à–ª–æ–π —Å—Ç–∞—Ç—å–µ –∏ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞—Ä–µ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

<p align="center">
    <img src="/img/2020-04-27/ctf-setup-part1/mail.png" width="500">
</p>

–í —Ç–æ—Ç –º–æ–º–µ–Ω—Ç –º–æ–µ–π –Ω–∞–∏–≤–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –±—ã–ª–æ —Ç–æ–ª—å–∫–æ –ø–æ–∑–∞–≤–∏–¥–æ–≤–∞—Ç—å. –°–∫–æ–ª—å–∫–æ –±—ã –Ω–∏ –∂–¥–∞–ª, –Ω–æ –ø–∏—Å—å–º–æ –Ω–∞ –ø–æ—á—Ç—É —Ç–∞–∫ –∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ, —Å—Ç—Ä–∞–Ω–Ω–æ –∫–∞–∫-—Ç–æ ü§î.  
–ù–µ –¥–æ–ª–≥–æ –¥—É–º–∞—è, –ø–æ–ª–µ–∑ –≤ –ª–æ–≥–∏, –≤–∏–∂—É —Å–ª–µ–¥—É—é—â–µ–µ:
```
mail_tester registered (UNCONFIRMED) with <user>@<domain>.com
mail_tester initiated a confirmation email resend
mail_tester initiated a confirmation email resend
mail_tester initiated a confirmation email resend
...
```
–í –ª–æ–≥–µ –æ—à–∏–±–æ–∫ –≤–æ–æ–±—â–µ –ø—É—Å—Ç–æ—Ç–∞.. —á—Ç–æ –∑–∞ —Ñ–∏–≥–Ω—è?!  
–ó–∞–ø—É—Å–∫–∞—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –ø–æ—á—Ç—ã, –ø–∏—Å—å–º–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç, —á–µ—Ä–µ–∑ Thunderbird —Ç–æ–∂–µ. –ß—É–¥–µ—Å–∞ –∫–∞–∫–∏–µ-—Ç–æ..  
–¢–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, –ø—Ä–æ–±–æ–≤–∞–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞, –∫–∞—Ä—Ç–∏–Ω–∞ –≤—Å—ë —Ç–∞ –∂–µ.

–ù–æ—á—å—é —Ä–µ—à–∏–ª —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç, –∏ —Ç—É—Ç –ø–æ–Ω–µ—Å–ª–∞—Å—å..

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/smtp_test.png" width="500">
</p>

–°–ü–ê–ú!? –ß–µ–≥–æ?! –ê –≤—ã —Ç–∞–º –Ω–µ –æ–±—É—Ä–µ–ª–∏!?  
–£—à–∏ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö –∏–∑—Ä—è–¥–Ω–æ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª–∏. –ó–∞—Ç–æ —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–ª–æ —è—Å–Ω–æ, –≥–¥–µ —Å–æ–±–∞–∫–∞ –∑–∞—Ä—ã—Ç–∞.  

–ü—Ä–∏—à–ª–æ—Å—å –ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ø–Ω–¥–µ–∫—Å–∞, –æ–±—ä—è—Å–Ω—è—Ç—å —á—Ç–æ –∫ —á–µ–º—É.  
–ö —Å–ª–æ–≤—É, –æ—Ç–≤–µ—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ 10 –¥–Ω–µ–π –Ω–∞–∑–∞–¥. –í–æ—Ç —ç—Ç–æ –¥–∞, –≤–æ—Ç —ç—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.  
–¢–æ—á–Ω–µ–µ –ø–æ —Å—É—â–µ—Å—Ç–≤—É –ø—Ä–æ–±–ª–µ–º—ã –≤–æ–æ–±—â–µ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏, –∞ –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏–ª–∏, –∞–∫—Ç—É–∞–ª–µ–Ω –ª–∏ –≤–æ–ø—Ä–æ—Å. –î–∞, —Ä–µ–±—è—Ç, –≤–æ–≤—Ä–µ–º—è, —è –¥–∞–∂–µ —É—Å–ø–µ–ª –∑–∞–±—ã—Ç—å –ø—Ä–æ –≤–∞—Å.

–í –∫–æ–Ω–µ—á–Ω–æ–º –∏—Ç–æ–≥–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–æ—á—Ç–æ–π –∏ –≤—Å—ë –ø–æ—à–ª–æ-–ø–æ–µ—Ö–∞–ª–æ.

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/received_mail.png" width="500">
</p>

## 0007. –¢–∞–∫, –∞ —á—Ç–æ —Å Advanced?
–ü–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ CTFd –ø—Ä–æ—Å—Ç–∞ –∏ –≥–µ–Ω–∏–∞–ª—å–Ω–∞ –¥–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –Ω—É –í—ã –ø–æ–Ω—è–ª–∏)

<p align="center">
    <img src="/img/2020-04-29/ctf-setup-part2/just-do-it.jpg" width="500">
</p>

–°—Ä–∞–∑—É –æ–ø–∏—à—É –ø—Ä–æ–±–ª–µ–º—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è:
- –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ–¥, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Ä–æ–π –±—ã–≤–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ü–µ–ª–∏–∫–æ–º —Å–µ—Ä–≤–µ—Ä. –¢–∞–∫ –∏ –Ω–µ –ø–æ–Ω—è–ª, —Å —á–µ–º —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ;
- –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ reverse proxy –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç—É –ø–æ https –Ω–∞ –ø–æ—Ä—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≥—Ä–µ—à–∏–ª, —á—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –ò—Å–ø—Ä–æ–±–æ–≤–∞–ª –∫—É—á—É –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx, –≤ –∏—Ç–æ–≥–µ –≤–µ—Ä–Ω—É–ª—Å—è –∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–º—É. –û–∫–∞–∑–∞–ª–æ—Å—å, –Ω–∞–¥–æ —á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞, –∏–Ω–∞—á–µ –æ–Ω —Ç—É–ø–∏—Ç —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏. –í—ã—è—Å–Ω–∏–ª–æ—Å—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–Ω–µ–∑–∞–ø–Ω–æ, –∫–æ–≥–¥–∞ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Ä–µ—à–∏–ª –∑–∞–π—Ç–∏ ü§ó

–ü–µ—Ä–≤–æ–µ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –æ —á—ë–º –Ω–∞–º –ª—é–±–µ–∑–Ω–æ —Å–æ–æ–±—â–∞—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.  
–í—ã–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–π –∫–æ–¥ –∏–∑ –ø–∞–ø–∫–∏ CTFd.
```bash
python -c "import os; f=open('.ctfd_secret_key', 'a+'); f.write(os.urandom(64));"
```

–ê –≤–æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É reverse proxy –æ–Ω–∏ –æ—Å—Ç–∞–≤–∏–ª–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è..

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ `docker-compose.yml`, –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–π–º—ë–º—Å—è —Ä–∞–∑–¥–µ–ª–æ–º `ctfd`:
```yaml
environment:
    - WORKERS=4
    - REVERSE_PROXY=true
    - LOG_FOLDER=/var/log/CTFd
    - ACCESS_LOG=/var/log/CTFd/access.log
    - ERROR_LOG=/var/log/CTFd/error.log
volumes:
    - </path/to/logs>:/var/log/CTFd
    - </path/to/uploads>:/var/uploads
```
–ó–∞–¥–∞—ë–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Worker'–æ–≤ –∏ —É–∫–∞–∑—ã–≤–∞–µ–º, –∫—É–¥–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫–∏ —Å –ª–æ–≥–∞–º–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞–º–∏ –Ω–∞ —Ö–æ—Å—Ç–µ.  
–õ–æ–≥–∏ –∏ –±–µ–∑ —Ç–æ–≥–æ –Ω–µ –æ—Å–æ–±–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ, –ø—É—Å—Ç—å —Ö–æ—Ç—è –±—ã –ª–µ–∂–∞—Ç –≤ —É–¥–æ–±–Ω–æ–º –¥–ª—è –Ω–∞—Å –º–µ—Å—Ç–µ.  
–¢–∞–∫–∂–µ –Ω–µ –∑–∞–±—ã–≤–∞–µ–º, —á—Ç–æ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å reverse proxy, –æ —á—ë–º —Å–æ–æ–±—â–∞–µ–º —Å—Ç—Ä–æ–∫–æ–π `REVERSE_PROXY=true`.

–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º —Ä–∞–∑–¥–µ–ª –¥–ª—è reverse proxy:
```yaml
reverse_proxy:
    image: nginx:mainline-alpine
    restart: always
    hostname: NGINX_HOSTNAME=<domain.org>
    ports:
        - "80:80"
        - "443:443"
    volumes:
        - ./nginx-conf/nginx.conf:/etc/nginx/nginx.conf
        - ./nginx-logs:/var/log/nginx
        - /etc/letsencrypt:/etc/letsencrypt
        - /var/lib/letsencrypt:/var/lib/letsencrypt
    networks:
      default:
      internal:
    depends_on:
      - ctfd
```

–ü–µ—Ä–≤–æ–µ, –Ω–∞ —á—Ç–æ –Ω–∞–¥–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ - –ø–æ–ª–µ `hostname`, –µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, –∏–Ω–∞—á–µ –Ω–µ –ø–æ–µ–¥–µ—Ç.  
–°–Ω–æ–≤–∞ –º–æ–Ω—Ç–∏—Ä—É–µ–º –ø–∞–ø–∫—É —Å –ª–æ–≥–∞–º–∏ –Ω–∞ —Ö–æ—Å—Ç, –Ω–µ –∑–∞–±—ã–≤–∞–µ–º –∏ –ø—Ä–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø—Ä–∏–≤–µ—Ç, Let‚Äôs Encrypt.  
–ö–æ–Ω—Ñ–∏–≥ nginx —Ç–∞–∫–∂–µ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä—É–µ–º, –Ω–æ –ø—Ä–µ–∂–¥–µ –≤ —Ä–∞–∑–¥–µ–ª `http` —Ñ–∞–π–ª–∞ `nginx.conf` –¥–æ–±–∞–≤–∏–º —Å–ª–µ–¥—É—é—â–µ–µ:

```apacheconf
upstream ctfd_app {
    server ctfd:8000 fail_timeout=0;
}
        
server {
    listen 8000 default_server;
    return 444;
}
        
server {
    listen 80 default_server;
    server_name _;
    return 301 https://$host$request_uri;
}

server {
    listen                  443 ssl;
    server_name             <domain.org>;
    ssl_certificate         /etc/letsencrypt/live/<domain.org>/fullchain.pem;
    ssl_certificate_key     /etc/letsencrypt/live/<domain.org>/privkey.pem;
    ssl_ciphers             HIGH:!aNULL:!MD5;
    ssl_protocols           TLSv1 TLSv1.1 TLSv1.2;
    
    location / {
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto https;
        proxy_set_header        Host $http_host;
        proxy_redirect          off;
        proxy_buffering         off;
        proxy_pass              http://ctfd_app;
    }
}
```

–ö–∞–∫ —è —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª, —Å–µ—Ä—Ç–∏—Ñ–∫–∞—Ç –º–æ–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å —É Let‚Äôs Encrypt, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è `certbot`.
–î–æ–±–∞–≤–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º –µ–≥–æ:
```bash
sudo apt update
sudo add-apt-repository universe
sudo add-apt-repository ppa:certbot/certbot
sudo apt update
sudo apt install certbot
```

–û–±—Ä–∞—â–∞–µ–º—Å—è –∫ `certbot` –∏ —Å–ª–µ–¥—É–µ–º –µ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è–º:
```bash
sudo certbot certonly --standalone -d domain.org
```

–í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞ –ø–æ –ø—É—Ç–∏ `/etc/letsencrypt/live/<domain.org>/` –ø–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã `fullchain.pem` –∏ `privkey.pem`.

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ä–¥—É —Å –ø–æ–º–æ—â—å—é `docker-compose`, —Å–æ–≤–µ—Ç—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Å —Ñ–ª–∞–≥–æ–º `--force-recreate`, —á—Ç–æ–±—ã —É–∂ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞.

–ù–µ–º–Ω–æ–≥–æ –∂–¥—ë–º, —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è–µ–º—Å—è, —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è –¥–æ—Å—Ç—É–ø –ø–æ HTTPS –∏ —Ä–∞–¥—É–µ–º—Å—è –∂–∏–∑–Ω–∏!

–ù–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π —á–∏—Ç–∞—Ç–µ–ª—å, —Ä–∞–∑–≤–µ—Ä–Ω—É–≤—à–∏–π –±–æ—Ä–¥—É, –º–æ–≥ –∑–∞–º–µ—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–Ω—ã–π –±–∞–≥ –≤ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã.  
–ü–æ–º–Ω–∏—Ç–µ, —è –æ–±—Ä–∞—â–∞–ª –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏ CTFd? –í–æ –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ CTF –±—ã–ª–∞ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏—è 2.3.1, —Ç–∞–∫ –≤–æ—Ç –±–∞–≥ –¥–æ —Å–∏—Ö –ø–æ—Ä –æ—Å—Ç–∞–ª—Å—è üò¨.  

–í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –Ω–µ —Ç–æ–ª—å–∫–æ –æ –Ω—ë–º, –Ω–æ –∏ –æ–∫—É–Ω—ë–º—Å—è —Å –≥–æ–ª–æ–≤–æ–π –≤ –∫–∏—à–∫–∏ CTFd!
